<!DOCTYPE html>
<html>
<head>
    <title>NxtBus - Sample Data Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 20px; border: 2px solid #ddd; border-radius: 8px; background: #fafafa; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #007bff; }
        button { padding: 12px 24px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .result.info { background: #d1ecf1; border: 1px solid #bee5eb; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .data-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; }
        .data-card h4 { margin-top: 0; color: #333; }
        .stat { display: inline-block; margin: 5px 10px; padding: 5px 10px; background: #e9ecef; border-radius: 3px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöå NxtBus - Sample Data Verification</h1>
        <p>Test all sample data and verify the system is working with realistic data</p>
        
        <div class="test-section">
            <h2>üîê Quick Login Test</h2>
            <button onclick="testOwnerLogin()">Test Owner Login (Sharma Transport)</button>
            <button onclick="testDriverLogin()">Test Driver Login (Rajesh Kumar)</button>
            <button onclick="testAdminLogin()">Test Admin Login</button>
            <div id="login-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üöå Fleet Data Overview</h2>
            <button onclick="loadFleetData()">Load Fleet Data</button>
            <div id="fleet-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üöç Active Trips & Real-time Data</h2>
            <button onclick="loadActiveTrips()">Load Active Trips</button>
            <div id="trips-results"></div>
        </div>
        
        <div class="test-section">
            <h2>‚ö†Ô∏è Delays & Notifications</h2>
            <button onclick="loadDelaysAndNotifications()">Load Delays & Notifications</button>
            <div id="delays-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üí¨ Feedback & Call Alerts</h2>
            <button onclick="loadFeedbackAndAlerts()">Load Feedback & Call Alerts</button>
            <div id="feedback-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Complete System Status</h2>
            <button onclick="runCompleteTest()">Run Complete System Test</button>
            <div id="complete-results"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';

        function updateResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const resultClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML += `<div class="result ${resultClass}">${message}</div>`;
        }

        function clearResult(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        async function testOwnerLogin() {
            clearResult('login-results');
            updateResult('login-results', 'üîç Testing Owner Login (Sharma Transport)...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/auth/owner/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: '9876500001', pin: '1234' })
                });
                
                const data = await response.json();
                if (data.success) {
                    updateResult('login-results', `‚úÖ Owner Login Success: ${data.owner.name}`, 'success');
                    updateResult('login-results', `üìß Email: ${data.owner.email} | üìç ${data.owner.address}`, 'info');
                } else {
                    updateResult('login-results', `‚ùå Owner Login Failed: ${data.message}`, 'error');
                }
            } catch (error) {
                updateResult('login-results', `‚ùå Owner Login Error: ${error.message}`, 'error');
            }
        }

        async function testDriverLogin() {
            updateResult('login-results', 'üîç Testing Driver Login (Rajesh Kumar)...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/auth/driver/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: '9876543210', pin: '1234' })
                });
                
                const data = await response.json();
                if (data.success) {
                    updateResult('login-results', `‚úÖ Driver Login Success: ${data.driver.name}`, 'success');
                    updateResult('login-results', `üöå Assigned Buses: ${data.driver.assignedBuses?.join(', ')}`, 'info');
                } else {
                    updateResult('login-results', `‚ùå Driver Login Failed: ${data.message}`, 'error');
                }
            } catch (error) {
                updateResult('login-results', `‚ùå Driver Login Error: ${error.message}`, 'error');
            }
        }

        async function testAdminLogin() {
            updateResult('login-results', 'üîç Testing Admin Login...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/auth/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                const data = await response.json();
                if (data.success) {
                    updateResult('login-results', `‚úÖ Admin Login Success: ${data.admin.name}`, 'success');
                    updateResult('login-results', `üëë Role: ${data.admin.role} | üìß ${data.admin.email}`, 'info');
                } else {
                    updateResult('login-results', `‚ùå Admin Login Failed: ${data.message}`, 'error');
                }
            } catch (error) {
                updateResult('login-results', `‚ùå Admin Login Error: ${error.message}`, 'error');
            }
        }

        async function loadFleetData() {
            clearResult('fleet-results');
            updateResult('fleet-results', 'üöå Loading Fleet Data...', 'info');
            
            try {
                const [buses, routes] = await Promise.all([
                    fetch(`${API_BASE}/buses`).then(r => r.json()),
                    fetch(`${API_BASE}/routes`).then(r => r.json())
                ]);
                
                updateResult('fleet-results', `‚úÖ Fleet Data Loaded Successfully`, 'success');
                
                const fleetHtml = `
                    <div class="data-grid">
                        <div class="data-card">
                            <h4>üöå Buses Overview</h4>
                            <div class="stat">Total: ${buses.length}</div>
                            <div class="stat">Active: ${buses.filter(b => b.status === 'active').length}</div>
                            <div class="stat">Maintenance: ${buses.filter(b => b.status === 'maintenance').length}</div>
                            <div class="stat">Electric: ${buses.filter(b => b.fuelType === 'Electric').length}</div>
                        </div>
                        <div class="data-card">
                            <h4>üõ£Ô∏è Routes Overview</h4>
                            <div class="stat">Total Routes: ${routes.length}</div>
                            <div class="stat">Active: ${routes.filter(r => r.status === 'active').length}</div>
                            <div class="stat">Avg Duration: ${Math.round(routes.reduce((sum, r) => sum + r.estimatedDuration, 0) / routes.length)} min</div>
                        </div>
                        <div class="data-card">
                            <h4>üöå Sample Buses</h4>
                            ${buses.slice(0, 3).map(bus => `
                                <div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 3px;">
                                    <strong>${bus.number}</strong> (${bus.type}) - ${bus.status}
                                    <br><small>${bus.model} ${bus.year}</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                updateResult('fleet-results', fleetHtml, 'info');
                
            } catch (error) {
                updateResult('fleet-results', `‚ùå Fleet Data Error: ${error.message}`, 'error');
            }
        }

        async function loadActiveTrips() {
            clearResult('trips-results');
            updateResult('trips-results', 'üöç Loading Active Trips...', 'info');
            
            try {
                const trips = await fetch(`${API_BASE}/trips/active`).then(r => r.json());
                
                updateResult('trips-results', `‚úÖ Active Trips Loaded: ${trips.length} trips`, 'success');
                
                const tripsHtml = `
                    <div class="data-grid">
                        ${trips.map(trip => `
                            <div class="data-card">
                                <h4>üöç ${trip.busNumber}</h4>
                                <div><strong>Driver:</strong> ${trip.driverName}</div>
                                <div><strong>Route:</strong> ${trip.routeName}</div>
                                <div><strong>Progress:</strong> ${trip.progress}%</div>
                                <div><strong>Speed:</strong> ${trip.currentGps?.speed || 0} km/h</div>
                                <div><strong>Max Speed:</strong> ${trip.maxSpeed} km/h</div>
                                <div><strong>Location:</strong> ${trip.currentGps?.lat?.toFixed(4)}, ${trip.currentGps?.lon?.toFixed(4)}</div>
                                <div class="stat">GPS Updates: ${trip.gpsUpdateCount}</div>
                                <div class="stat">Overspeed: ${trip.overspeedCount}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                updateResult('trips-results', tripsHtml, 'info');
                
            } catch (error) {
                updateResult('trips-results', `‚ùå Active Trips Error: ${error.message}`, 'error');
            }
        }

        async function loadDelaysAndNotifications() {
            clearResult('delays-results');
            updateResult('delays-results', '‚ö†Ô∏è Loading Delays & Notifications...', 'info');
            
            try {
                const [delays, notifications] = await Promise.all([
                    fetch(`${API_BASE}/admin/delays`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/notifications`).then(r => r.json()).catch(() => [])
                ]);
                
                updateResult('delays-results', `‚úÖ Data Loaded: ${delays.length} delays, ${notifications.length} notifications`, 'success');
                
                const delaysHtml = `
                    <div class="data-grid">
                        <div class="data-card">
                            <h4>‚ö†Ô∏è Delays Summary</h4>
                            <div class="stat">Total: ${delays.length}</div>
                            <div class="stat">Active: ${delays.filter(d => d.status === 'active').length}</div>
                            <div class="stat">Resolved: ${delays.filter(d => d.status === 'resolved').length}</div>
                            <div class="stat">Avg Delay: ${delays.length ? Math.round(delays.reduce((sum, d) => sum + d.delayMinutes, 0) / delays.length) : 0} min</div>
                        </div>
                        <div class="data-card">
                            <h4>üì¢ Notifications Summary</h4>
                            <div class="stat">Total: ${notifications.length}</div>
                            <div class="stat">Active: ${notifications.filter(n => n.status === 'active').length}</div>
                            <div class="stat">High Priority: ${notifications.filter(n => n.priority === 'high').length}</div>
                        </div>
                    </div>
                `;
                
                updateResult('delays-results', delaysHtml, 'info');
                
            } catch (error) {
                updateResult('delays-results', `‚ùå Delays & Notifications Error: ${error.message}`, 'error');
            }
        }

        async function loadFeedbackAndAlerts() {
            clearResult('feedback-results');
            updateResult('feedback-results', 'üí¨ Loading Feedback & Call Alerts...', 'info');
            
            try {
                const [feedbacks, callAlerts] = await Promise.all([
                    fetch(`${API_BASE}/feedbacks`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/callAlerts`).then(r => r.json()).catch(() => [])
                ]);
                
                updateResult('feedback-results', `‚úÖ Data Loaded: ${feedbacks.length} feedbacks, ${callAlerts.length} call alerts`, 'success');
                
                const avgRating = feedbacks.length ? 
                    (feedbacks.reduce((sum, f) => sum + f.rating, 0) / feedbacks.length).toFixed(1) : 0;
                
                const feedbackHtml = `
                    <div class="data-grid">
                        <div class="data-card">
                            <h4>üí¨ Feedback Summary</h4>
                            <div class="stat">Total: ${feedbacks.length}</div>
                            <div class="stat">Avg Rating: ${avgRating}/5</div>
                            <div class="stat">Pending: ${feedbacks.filter(f => f.status === 'pending').length}</div>
                            <div class="stat">Reviewed: ${feedbacks.filter(f => f.status === 'reviewed').length}</div>
                        </div>
                        <div class="data-card">
                            <h4>üìû Call Alerts Summary</h4>
                            <div class="stat">Total: ${callAlerts.length}</div>
                            <div class="stat">Active: ${callAlerts.filter(c => !c.acknowledged).length}</div>
                            <div class="stat">Acknowledged: ${callAlerts.filter(c => c.acknowledged).length}</div>
                        </div>
                    </div>
                `;
                
                updateResult('feedback-results', feedbackHtml, 'info');
                
            } catch (error) {
                updateResult('feedback-results', `‚ùå Feedback & Alerts Error: ${error.message}`, 'error');
            }
        }

        async function runCompleteTest() {
            clearResult('complete-results');
            updateResult('complete-results', 'üß™ Running Complete System Test...', 'info');
            
            // Run all tests
            await testOwnerLogin();
            await testDriverLogin();
            await testAdminLogin();
            await loadFleetData();
            await loadActiveTrips();
            await loadDelaysAndNotifications();
            await loadFeedbackAndAlerts();
            
            updateResult('complete-results', 'üéâ Complete System Test Finished!', 'success');
            updateResult('complete-results', '‚úÖ All sample data is loaded and working correctly', 'success');
            updateResult('complete-results', 'üöÄ System is ready for full testing and demonstration', 'success');
        }

        // Auto-run basic test on page load
        window.onload = function() {
            setTimeout(() => {
                updateResult('complete-results', 'üîÑ Auto-running basic connectivity test...', 'info');
                testOwnerLogin();
            }, 1000);
        };
    </script>
</body>
</html>